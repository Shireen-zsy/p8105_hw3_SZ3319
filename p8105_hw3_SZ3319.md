p8105_hw3_SZ3319
================
Shiyu Zhang
2024-10-09

## Problem 1

Import `ny_noaa` dataset and look at the size and the structure.

``` r
data("ny_noaa")
str(ny_noaa)
```

    ## tibble [2,595,176 × 7] (S3: tbl_df/tbl/data.frame)
    ##  $ id  : chr [1:2595176] "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" ...
    ##  $ date: Date[1:2595176], format: "2007-11-01" "2007-11-02" ...
    ##  $ prcp: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snow: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snwd: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ tmax: chr [1:2595176] NA NA NA NA ...
    ##  $ tmin: chr [1:2595176] NA NA NA NA ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   id = col_character(),
    ##   ..   date = col_date(format = ""),
    ##   ..   prcp = col_integer(),
    ##   ..   snow = col_integer(),
    ##   ..   snwd = col_integer(),
    ##   ..   tmax = col_character(),
    ##   ..   tmin = col_character()
    ##   .. )

``` r
dim(ny_noaa)
```

    ## [1] 2595176       7

``` r
head(ny_noaa)
```

    ## # A tibble: 6 × 7
    ##   id          date        prcp  snow  snwd tmax  tmin 
    ##   <chr>       <date>     <int> <int> <int> <chr> <chr>
    ## 1 US1NYAB0001 2007-11-01    NA    NA    NA <NA>  <NA> 
    ## 2 US1NYAB0001 2007-11-02    NA    NA    NA <NA>  <NA> 
    ## 3 US1NYAB0001 2007-11-03    NA    NA    NA <NA>  <NA> 
    ## 4 US1NYAB0001 2007-11-04    NA    NA    NA <NA>  <NA> 
    ## 5 US1NYAB0001 2007-11-05    NA    NA    NA <NA>  <NA> 
    ## 6 US1NYAB0001 2007-11-06    NA    NA    NA <NA>  <NA>

``` r
skimr::skim(ny_noaa)
```

|                                                  |         |
|:-------------------------------------------------|:--------|
| Name                                             | ny_noaa |
| Number of rows                                   | 2595176 |
| Number of columns                                | 7       |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |         |
| Column type frequency:                           |         |
| character                                        | 3       |
| Date                                             | 1       |
| numeric                                          | 3       |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |         |
| Group variables                                  | None    |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| id            |         0 |          1.00 |  11 |  11 |     0 |      747 |          0 |
| tmax          |   1134358 |          0.56 |   1 |   4 |     0 |      532 |          0 |
| tmin          |   1134420 |          0.56 |   1 |   4 |     0 |      548 |          0 |

**Variable type: Date**

| skim_variable | n_missing | complete_rate | min        | max        | median     | n_unique |
|:--------------|----------:|--------------:|:-----------|:-----------|:-----------|---------:|
| date          |         0 |             1 | 1981-01-01 | 2010-12-31 | 1997-01-21 |    10957 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate |  mean |     sd |  p0 | p25 | p50 | p75 |  p100 | hist  |
|:--------------|----------:|--------------:|------:|-------:|----:|----:|----:|----:|------:|:------|
| prcp          |    145838 |          0.94 | 29.82 |  78.18 |   0 |   0 |   0 |  23 | 22860 | ▇▁▁▁▁ |
| snow          |    381221 |          0.85 |  4.99 |  27.22 | -13 |   0 |   0 |   0 | 10160 | ▇▁▁▁▁ |
| snwd          |    591786 |          0.77 | 37.31 | 113.54 |   0 |   0 |   0 |   0 |  9195 | ▇▁▁▁▁ |

This dataset `ny_noaa` is weather observation data from the National
Oceanic and Atmospheric Administration (NOAA) in New York, which
includes **2595176** observations and **7** variables.

The **7** important variables are: **id, date, prcp, snow, snwd, tmax,
tmin**:

- `id` (Weather Station ID): the unique identifier for each observation
  station. **Type:** Character.

- `date` (Date of Observation): the date of the weather observation in
  the format YYYY-MM-DD. **Type:** Date.

- `prcp` (Precipitation): the precipitation amount in tenths of a
  millimeter, indicating the amount of rain that fell on a specific
  date. **Type:** Integer, which need to be transferred into numeric.

- `snow` (Snowfall): the snowfall amount in millimeters, indicating the
  depth of new snow that fell on a specific date. **Type:** Integer,
  which need to be transferred into numeric.

- `snwd` (Snow Depth): the snow depth in millimeters, indicating the
  thickness of the snowpack on a specific date. **Type:** Integer, which
  need to be transferred into numeric.

- `tmax` (Maximum Temperature): the maximum temperature in tenths of
  degrees Celsius, indicating the highest temperature recorded on a
  specific date. **Type:** Character, which need to be transferred into
  numeric.

- `tmin` (Minimum Temperature): the minimum temperature in tenths of
  degrees Celsius, indicating the lowest temperature recorded on a
  specific date. **Type:** Character, which need to be transferred into
  numeric.

There are

### 1.1 Clean the dataset

- Clean the dataset

``` r
ny_noaa = 
  data.frame(ny_noaa) |> 
  janitor::clean_names() |> 
  mutate(
    year = year(date),
    month = month(date),
    day = day(date),
    across(c(year, month, day, prcp, snow, snwd, tmin, tmax), as.numeric),
    prcp = prcp / 10,
    tmax = tmax / 10,
    tmin = tmin / 10
  )
```

View the

``` r
common_snow = 
  ny_noaa  |> 
  filter(snow >= 0)  |> 
  group_by(snow) |> 
  summarise(count = n()) |> 
  arrange(desc(count))  |> 
  head(10)
```

The result indicates that:

- **0 mm** snowfall is most common, which mens that on the majority of
  days, there was no snowfall in the New York area.
- Snowfall amounts of 25 mm or less are relatively common, reflecting
  winter snowfall patterns.
- Although snowfall greater than 100 mm is not common, it can still
  occur, particularly during extreme weather events.

### 1.2 Creat a

``` r
ny_noaa_month = 
  ny_noaa |>
  filter(
    month == c(1, 7),
    !is.na(tmax)
  ) |> 
  mutate(
    month = as.character(month),
    month = case_match(
      month,
      "1" ~ "January",
      "7" ~ "July"
    )
  ) |> 
  group_by(id, year, month) |> 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE)) |> 
  ungroup()
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

``` r
ny_noaa_month |> 
  ggplot(aes(x = year, y = avg_tmax, colour = id)) +
  geom_line(alpha = .3) +
  labs(
    title = "Line graph of average maximum temperatures per year",
       x = "Date",
       y = "Maximum Temp (°C)"
  ) +
  facet_wrap(. ~ month) +
  theme_minimal() +
  theme(legend.position = "none")
```

![](p8105_hw3_SZ3319_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

From the plot, it shows that:

- The clear temperature difference between January (winter) and July
  (summer) is consistent with expected seasonal variation.

- Overall, the trends in average maximum temperatures over the years are
  consistent across different stations. Individual outliers may be
  attributed to extreme climatic events occurring at specific weather
  station locations.

- Both months reflect seasonal temperature patterns typical for winter
  and summer. While January generally shows lower temperatures due to
  winter conditions, and July shows higher temperatures due to summer
  heat, both months may exhibit similar trends in their respective
  temperature increases or decreases over the years.

### 1.3 Create a

``` r
ny_noaa_clean = ny_noaa %>%
  janitor::clean_names() %>%
  mutate(
    snow = ifelse(snow > 0 & snow < 100, snow, NA)# Keep only snow values between 0 and 100
  ) |> 
   filter(
    !is.na(year),
    !is.na(snow)
    )

# Panel (i): tmax vs tmin
panel_i <- 
  ny_noaa |> 
  filter(
    !is.na(tmax),
    !is.na(tmin)
    ) |> 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex() + # Using a hexbin plot instead of scatter
  labs(
    title = "tmax vs tmin",
    x = "Minimum Temperature (C)",
    y = "Maximum Temperature (C)"
  ) 

library(ggridges)
# Panel (ii): Distribution of snowfall
panel_ii = 
  ny_noaa_clean |> 
  ggplot(aes(y = factor(year), x = snow, fill = factor(year))) +
  geom_density_ridges()+
  labs(
    title = "Distribution of Snowfall (0 < snow < 100) by Year",
    y = "Year",
    x = "Snowfall (mm)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

(panel_i + panel_ii) # combine 2 plots 
```

    ## Picking joint bandwidth of 3.76

![](p8105_hw3_SZ3319_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

## Problem 2

### 2.0 Load the datesets

``` r
demo_df = 
  read_csv("data/nhanes_covar.csv", 
           na = c("NA", "", "."), 
           skip = 4) |> 
  janitor::clean_names()
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
str(demo_df)
```

    ## spc_tbl_ [250 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
    ##  $ seqn     : num [1:250] 62161 62164 62169 62174 62177 ...
    ##  $ sex      : num [1:250] 1 2 1 1 1 1 1 1 2 2 ...
    ##  $ age      : num [1:250] 22 44 21 80 51 80 35 26 17 30 ...
    ##  $ bmi      : num [1:250] 23.3 23.2 20.1 33.9 20.1 28.5 27.9 22.1 22.9 22.4 ...
    ##  $ education: num [1:250] 2 3 2 3 2 2 3 2 NA 3 ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   SEQN = col_double(),
    ##   ..   sex = col_double(),
    ##   ..   age = col_double(),
    ##   ..   BMI = col_double(),
    ##   ..   education = col_double()
    ##   .. )
    ##  - attr(*, "problems")=<externalptr>

``` r
ac_df = 
  read_csv("data/nhanes_accel.csv", na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  na.omit()
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

### 2.1 Clean

Include all originally observed variables; exclude participants less
than 21 years of age, and those with missing demographic data; and
encode data with reasonable variable classes (i.e. not numeric, and
using factors with the ordering of tables and plots in mind).

``` r
demo_clean_df = 
  demo_df |> 
  filter(age >= 21) |>
  na.omit() |> 
  mutate(
    education = factor(education, 
                       levels = c("1", "2", "3"), 
                       labels = c("Less than high school", "High school equivalent", "More than high school"),
                       ordered = TRUE),
    sex = factor(sex, 
                 levels = c("1", "2"),
                 labels = c("male", "female"), 
                 ordered = TRUE)
  ) 


total_df = 
  demo_clean_df |> 
  left_join(ac_df, by = "seqn")

#str(total_df)
```

### 2.2 age table and plot

age table

``` r
edu_gender_table = 
  total_df  |> 
  group_by(education, sex)  |> 
  summarize(count = n())  |> 
  pivot_wider(names_from = sex, values_from = count, values_fill = 0)
```

    ## `summarise()` has grouped output by 'education'. You can override using the
    ## `.groups` argument.

``` r
print(edu_gender_table)
```

    ## # A tibble: 3 × 3
    ## # Groups:   education [3]
    ##   education               male female
    ##   <ord>                  <int>  <int>
    ## 1 Less than high school     27     28
    ## 2 High school equivalent    35     23
    ## 3 More than high school     56     59

``` r
library(knitr)
kable(edu_gender_table, 
      col.names = c("Education Level", "Men", "Women"), 
      caption = "Number of Men and Women in Each Education Category")
```

| Education Level        | Men | Women |
|:-----------------------|----:|------:|
| Less than high school  |  27 |    28 |
| High school equivalent |  35 |    23 |
| More than high school  |  56 |    59 |

Number of Men and Women in Each Education Category

age plot

``` r
total_df |> 
  ggplot(aes(x = age, fill = sex)) +
  geom_histogram(bins = 20, position = "dodge") +
  facet_wrap(~ education) +
  labs(
    title = "Age Distribution by Education Level and Gender",
    x = "Age",
    y = "Count"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

![](p8105_hw3_SZ3319_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

### 2.3
